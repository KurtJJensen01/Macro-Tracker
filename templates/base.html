<!DOCTYPE html>
<html lang="en">
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <meta charset="UTF-8">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <title>{{ title }}</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <script>
      // Apply saved dark mode setting as early as possible after body exists
      if (localStorage.getItem('darkMode') === 'enabled') {
        document.body.classList.add('dark-mode');
      }
    </script>

    <nav class="navbar">
        <div class="nav-links">
            <a href="/food">Food</a> |
            <a href="/weight">Weight</a> |
            <a href="/settings">Settings</a>
        </div>
        <button id="darkModeToggle">ðŸŒ™</button>
    </nav>

    <script>
        const toggleBtn = document.getElementById('darkModeToggle');
        const body = document.body;

        // Set initial icon depending on mode on page load
        toggleBtn.textContent = body.classList.contains('dark-mode') ? 'â˜€ï¸' : 'ðŸŒ™';

        toggleBtn.addEventListener('click', () => {
          body.classList.toggle('dark-mode');

          if (body.classList.contains('dark-mode')) {
            toggleBtn.textContent = 'â˜€ï¸';
            localStorage.setItem('darkMode', 'enabled');
          } else {
            toggleBtn.textContent = 'ðŸŒ™';
            localStorage.setItem('darkMode', 'disabled');
          }
        });

        // Prevent horizontal swiping on mobile
        let startX = null;
        document.addEventListener('touchstart', function(e) {
          startX = e.touches[0].clientX;
        }, { passive: false });

        document.addEventListener('touchmove', function(e) {
          if (startX !== null) {
            let currentX = e.touches[0].clientX;
            let diffX = Math.abs(currentX - startX);
            let diffY = Math.abs(e.touches[0].clientY - (e.touches[1] ? e.touches[1].clientY : 0));
            
            // If horizontal swipe is detected, prevent it
            if (diffX > diffY && diffX > 10) {
              e.preventDefault();
            }
          }
        }, { passive: false });

        document.addEventListener('touchend', function() {
          startX = null;
        });
    </script>

    <hr>
    <h1>{{ title }}</h1>
    {% block content %}{% endblock %}
</body>
<br>
<foot>
    <a href="{{ url_for('export_food_logs') }}">Export Food Logs CSV</a>
    <a>|</a>
    <a href="{{ url_for('export_weight_logs') }}">Export Weight Logs CSV</a>
    <a>|</a>
    <a href="{{ url_for('export_saved_foods') }}">Export Saved Foods CSV</a>
</foot>
</html>
